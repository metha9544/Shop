<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>METIST - Flower & Luck</title>
    
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="METIST">

    <style>
        :root {
            --pink: #f8c8dc;
            --pink-dark: #d48398;
            --purple: #e6d9ff;
            --purple-dark: #9b5de5;
            --green: #d9f5e3;
            --bg: #fdf2f7;
            --text: #5a3d45;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 15px;
            color: var(--text);
        }

        .header { text-align: center; margin-bottom: 15px; }
        .header h1 { color: var(--pink-dark); margin: 0; font-size: 1.8rem; }
        .header p { color: #bca0a0; margin: 0; font-size: 0.8rem; letter-spacing: 2px; }

        .nav-menu { display: flex; gap: 5px; margin-bottom: 20px; }
        .nav-menu button {
            flex: 1; padding: 10px 2px; border: 1px solid #f2cbd3; border-radius: 12px;
            background: white; color: var(--pink-dark); font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); cursor: pointer; font-size: 11px;
        }
        .nav-menu button.active { background: var(--pink); color: white; border-color: var(--pink); }
        .en-sub { display: block; font-size: 8px; font-weight: normal; opacity: 0.8; }

        .page { display: none; }
        .page.active { display: block; }
        .card { 
            background: #fff; 
            border-radius: 20px; 
            padding: 18px; 
            margin-bottom: 15px; 
            box-shadow: 0 8px 20px rgba(212, 131, 152, 0.12);
        }
        h2 { font-size: 1.1rem; margin-top: 0; margin-bottom: 12px; }
        
        input { 
            width: 100%; 
            padding: 12px; 
            margin: 8px 0; 
            border-radius: 14px; 
            border: 1px solid #f2cbd3; 
            box-sizing: border-box; 
            font-size: 16px; 
        }

        .flower-flex-container { display: flex; justify-content: space-between; flex-wrap: nowrap; gap: 5px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .color-item { flex: 0 0 60px; text-align: center; min-width: 60px; cursor: pointer; }
        .color-btn { 
            width: 45px; height: 45px; border-radius: 50%; 
            border: 2px solid #fff; outline: 1px solid #eee;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
            margin: 0 auto; display: block; 
        }
        .count { font-size: 9px; margin-top: 5px; font-weight: bold; line-height: 1.2; }

        .type-selector { display: flex; gap: 10px; background: #fff0f3; padding: 8px; border-radius: 12px; justify-content: center; margin-bottom: 15px; font-size: 13px; }
        .grid-options { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .square-btn { 
            border: 1px solid rgba(0,0,0,0.05); border-radius: 10px; padding: 10px 2px; 
            color: #fff; cursor: pointer; font-size: 11px; font-weight: bold; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .order-item { background: white; border-radius: 18px; padding: 15px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .btn-group { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
        .status-btn { border: none; border-radius: 10px; padding: 8px 10px; color: white; font-weight: bold; cursor: pointer; font-size: 11px; }

        .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; }
        .summary-box { padding: 12px 5px; border-radius: 15px; text-align: center; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .summary-box span { display: block; font-size: 10px; margin-bottom: 3px; }
        
        .split-sales-container { display: flex; gap: 10px; margin-bottom: 15px; }
        .split-box { flex: 1; padding: 8px; border-radius: 12px; text-align: center; background: #ffd1dc; color: #fff; text-shadow: 1px 1px 0px rgba(0,0,0,0.1); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .split-box span { display: block; font-size: 10px; font-weight: bold; }
        .split-box div { font-size: 18px; font-weight: bold; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px 5px; text-align: center; font-size: 13px; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; color: #888; font-weight: normal; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); overflow-y: auto; }
        .modal-content { background: white; width: 85%; max-width: 320px; margin: 40px auto; padding: 20px; border-radius: 25px; text-align: center; }
        .receipt-border { border: 2px dashed var(--pink-dark); border-radius: 20px; padding: 20px; }
        .receipt-details { text-align: left; font-size: 0.9rem; line-height: 1.7; margin: 15px 0; border-top: 1px solid #f2f2f2; padding-top: 10px; }
    </style>
</head>
<body>

<div class="header">
    <h1>üå∏ METIST ‚ú®</h1>
    <p>FLOWER & LUCK</p>
</div>

<div class="nav-menu">
    <button id="btn-flower" class="active" onclick="switchPage('flower')">‡∏™‡∏±‡πà‡∏á‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ <span class="en-sub">Flower</span></button>
    <button id="btn-bracelet" onclick="switchPage('bracelet')">‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≥‡πÑ‡∏• <span class="en-sub">Bracelet</span></button>
    <button id="btn-orders" onclick="switchPage('orders')">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå <span id="nav-pending" style="color:red"></span><span class="en-sub">Order List</span></button>
    <button id="btn-summary" onclick="switchPage('summary')">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î <span class="en-sub">Summary</span></button>
</div>

<div id="page-flower" class="page active">
    <input id="customer" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
    
    <div class="card">
        <h2>üåπ ‡∏™‡∏µ‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ</h2>
        <div class="type-selector">
            <label><input type="radio" name="flowerType" value="‡∏Å‡∏£‡∏¥‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå" checked onchange="renderFlowers()"> ‡∏™‡∏µ‡∏Å‡∏£‡∏¥‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå</label>
            <label><input type="radio" name="flowerType" value="‡∏û‡∏∑‡πâ‡∏ô" onchange="renderFlowers()"> ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô</label>
        </div>
        <div class="flower-flex-container" id="flower-grid"></div>
        <input id="basePrice" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ä‡πà‡∏≠ (‡∏ö‡∏≤‡∏ó)" oninput="calcTotal()">
    </div>

    <div class="card">
        <h2>üì¶ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏´‡πà‡∏≠</h2>
        <div class="grid-options" id="paper-grid"></div>
        <div id="paperChoice" style="margin-top:8px; font-size:12px; font-weight:bold; color:var(--pink-dark)">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: -</div>
    </div>

    <div class="card">
        <h2>üéÄ ‡πÇ‡∏ö‡∏ß‡πå</h2>
        <div class="grid-options" id="bow-grid"></div>
        <div id="bowChoice" style="margin-top:8px; font-size:12px; font-weight:bold; color:var(--pink-dark)">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: -</div>
    </div>

    <div class="card">
        <h2>‚ú® ‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á</h2>
        <div class="grid-options" id="extra-grid"></div>
    </div>

    <div class="card" style="text-align:center; background: #fff0f3; border: 2px dashed var(--pink);">
        <h2 id="summary-text" style="margin-bottom:0;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: 0 ‡∏ö‡∏≤‡∏ó</h2>
    </div>
    
    <button onclick="saveOrder('‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ')" style="width:100%; background:var(--pink-dark); color:white; padding:15px; border:none; border-radius:18px; font-size:18px; font-weight:bold; cursor:pointer; margin-top:10px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
</div>

<div id="page-bracelet" class="page">
    <input id="customer-br" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">

    <div class="card">
        <h2>üîÆ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏¥‡∏ô (Lucky Stone)</h2>
        <p style="font-size:10px; color:gray; margin-top:-10px;">*‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà 2 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ +30 ‡∏ö‡∏≤‡∏ó</p>
        <div class="flower-flex-container">
            <div class="color-item" onclick="addStone('Rose Quartz')"><div class="color-btn" style="background: #eec9d2;"></div><div class="count">Rose Quartz</div></div>
            <div class="color-item" onclick="addStone('Jadiete')"><div class="color-btn" style="background: #a8e6cf;"></div><div class="count">Jadiete</div></div>
            <div class="color-item" onclick="addStone('Amethyst')"><div class="color-btn" style="background: #b39ddb;"></div><div class="count">Amethyst</div></div>
            <div class="color-item" onclick="addStone('Pyrite')"><div class="color-btn" style="background: #d4af37;"></div><div class="count">Pyrite</div></div>
            <div class="color-item" onclick="addStone('Aquamarine')"><div class="color-btn" style="background: #add8e6;"></div><div class="count">Aquamarine</div></div>
            <div class="color-item" onclick="addStone('Unakite')"><div class="color-btn" style="background: #9ab973;"></div><div class="count">Unakite</div></div>
        </div>
        <div id="stoneChoice" style="margin-top:8px; font-size:12px; font-weight:bold; color:var(--pink-dark)">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏¥‡∏ô: -</div>
        <button onclick="resetBracelet()" style="font-size:10px; margin-top:5px; border:none; background:#eee; padding:4px 8px; border-radius:5px;">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≥‡πÑ‡∏•</button>
    </div>

    <div class="card">
        <h2>‚õìÔ∏è ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÇ‡∏ã‡πà (Chain)</h2>
        <div class="grid-options">
            <div onclick="setChain('‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 1')" style="cursor:pointer; text-align:center;"><img src="001.png" width="45" height="45" style="border-radius:8px; border:1px solid #eee;"><div style="font-size:9px;">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 1</div></div>
            <div onclick="setChain('‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 2')" style="cursor:pointer; text-align:center;"><img src="002.png" width="45" height="45" style="border-radius:8px; border:1px solid #eee;"><div style="font-size:9px;">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 2</div></div>
            <div onclick="setChain('‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 3')" style="cursor:pointer; text-align:center;"><img src="003.png" width="45" height="45" style="border-radius:8px; border:1px solid #eee;"><div style="font-size:9px;">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 3</div></div>
            <div onclick="setChain('‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 4 (‡∏™‡∏µ‡∏ó‡∏≠‡∏á)')" style="cursor:pointer; text-align:center;"><img src="004.png" width="45" height="45" style="border-radius:8px; border:1px solid #eee;"><div style="font-size:9px;">‡∏™‡∏µ‡∏ó‡∏≠‡∏á +10‡∏ø</div></div>
        </div>
        <div id="chainChoice" style="margin-top:8px; font-size:12px; font-weight:bold; color:var(--pink-dark)">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡πà: -</div>
        <div style="margin-top:15px;">
            <label style="font-size: 13px; font-weight: bold;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠ (cm):</label>
            <input type="number" id="wrist-size" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠">
        </div>
    </div>

    <div class="card">
        <h2>üîí ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡∏•‡πá‡∏≠‡∏Ñ</h2>
        <div class="grid-options">
            <button class="square-btn" style="background:#bca0a0;" onclick="setLock('‡∏´‡πà‡∏ß‡∏á', 0)">‡∏´‡πà‡∏ß‡∏á (‡∏ü‡∏£‡∏µ)</button>
            <button class="square-btn" style="background:#f8c8dc; color:#5a3d45;" onclick="setLock('‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ', 10)">‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ (+10‡∏ø)</button>
        </div>
        <div id="lockChoice" style="margin-top:8px; font-size:12px; font-weight:bold; color:var(--pink-dark)">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏•‡πá‡∏≠‡∏Ñ: -</div>
    </div>

    <div class="card">
        <h2>‚ú® ‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á (Accessories)</h2>
        <div class="grid-options">
            <button class="square-btn" style="background:#eee; color:#333;" onclick="addAccessory('‡∏à‡∏µ‡πâ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏á‡∏¥‡∏ô')">‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏á‡∏¥‡∏ô</button>
            <button class="square-btn" style="background:#fae1a5; color:#333;" onclick="addAccessory('‡∏à‡∏µ‡πâ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏ó‡∏≠‡∏á')">‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏ó‡∏≠‡∏á</button>
            <button class="square-btn" style="background:#eee; color:#333;" onclick="addAccessory('‡∏à‡∏µ‡πâ‡∏î‡∏≤‡∏ß‡πÄ‡∏á‡∏¥‡∏ô')">‡∏î‡∏≤‡∏ß‡πÄ‡∏á‡∏¥‡∏ô</button>
            <button class="square-btn" style="background:#fae1a5; color:#333;" onclick="addAccessory('‡∏à‡∏µ‡πâ‡∏î‡∏≤‡∏ß‡∏ó‡∏≠‡∏á')">‡∏î‡∏≤‡∏ß‡∏ó‡∏≠‡∏á</button>
            <button class="square-btn" style="background:#fff; color:#333; border:1px solid #ddd;" onclick="addAccessory('‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å')">‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å</button>
        </div>
        <div id="accList" style="margin-top:8px; font-size:11px; color:#888;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: -</div>
    </div>

    <div class="card" style="text-align:center; background: #fdf2f7; border: 2px dashed var(--pink-dark);">
        <h2 id="br-summary-text" style="margin-bottom:0;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: 59 ‡∏ö‡∏≤‡∏ó</h2>
    </div>

    <button onclick="saveOrder('‡∏Å‡∏≥‡πÑ‡∏•')" style="width:100%; background:var(--pink-dark); color:white; padding:15px; border:none; border-radius:18px; font-size:18px; font-weight:bold; cursor:pointer; margin-top:10px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡∏≥‡πÑ‡∏•</button>
</div>

<div id="page-orders" class="page">
    <div class="card">
        <h2 style="margin-bottom:10px;">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
        <input type="text" id="searchOrder" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." oninput="renderOrderList()" style="margin-bottom:0;">
    </div>
<div style="display:flex; justify-content:space-between; align-items: center; padding:0 10px; margin-bottom:10px;">
    <div>
        <span id="pending-count" style="font-size:0.8rem; font-weight:bold; color:var(--pink-dark);"></span>
        <button onclick="showTaskSummary()" style="margin-left:10px; padding:5px 12px; background:var(--pink); border:none; border-radius:10px; color:var(--text); font-size:11px; font-weight:bold; cursor:pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥</button>
    </div>

    <span style="font-size:0.7rem; color:gray;">üå∏ ‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ | üîÆ ‡∏Å‡∏≥‡πÑ‡∏•</span>
</div>


    <div id="order-list"></div>
</div>

<div id="page-summary" class="page">
    <div class="summary-grid">
        <div class="summary-box" style="background:var(--green)"><span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</span><div id="stat-sale">0</div></div>
        <div class="summary-box" style="background:var(--purple)"><span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</span><div id="stat-cost">0</div></div>
        <div class="summary-box" style="background:var(--pink)"><span>‡∏Å‡∏≥‡πÑ‡∏£</span><div id="stat-profit">0</div></div>
    </div>
    <div class="split-sales-container">
        <div class="split-box"><span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ</span><div id="stat-flower-sale">0</div></div>
        <div class="split-box"><span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏Å‡∏≥‡πÑ‡∏•</span><div id="stat-bracelet-sale">0</div></div>
    </div>

    <div class="card" style="border: 1px solid var(--pink); background: #fff5f8;">
        <h3>üíæ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Backup)</h3>
        <div style="display: flex; gap: 10px;">
            <button onclick="exportData()" style="flex: 1; background: #51cf66; color: white; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <button onclick="document.getElementById('importFile').click()" style="flex: 1; background: #fab005; color: white; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
        <input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(event)">
    </div>

    <div class="card">
        <h3>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h3>
        <input type="text" id="cost-desc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
        <input type="number" id="cost-amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
        <button onclick="addCost()" style="width:100%; background:var(--purple); padding:12px; border:none; border-radius:12px; font-weight:bold; cursor: pointer;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</button>
    </div>
    
    <div class="card">
        <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h3>
        <table id="cost-table">
            <thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏¢‡∏≠‡∏î</th><th>‡∏•‡∏ö</th></tr></thead>
            <tbody id="cost-history-body"></tbody>
        </table>
    </div>
</div>

<div id="receiptModal" class="modal">
    <div class="modal-content">
        <div class="receipt-border">
            <h2 style="color:var(--pink-dark); margin-bottom:5px;">üå∏ METIST ‚ú®</h2>
            <div id="rc-date" style="font-size: 11px; color: #888;"></div>
            <div class="receipt-details" id="modal-body"></div>
            <div id="receipt-extras">
                <img src="qr.png" width="130">
                <p style="font-size: 10px; color: #888; margin-top: 10px;">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ôüíê</p>
            </div>
        </div>
        <button onclick="closeModal()" style="width:100%; background:#5a3d45; color:white; padding:12px; border:none; border-radius:15px; margin-top:15px; font-weight:bold;">‡∏õ‡∏¥‡∏î</button>
    </div>
</div>

<script>
    let orders = JSON.parse(localStorage.getItem("metist_orders") || "[]");
    let costs = JSON.parse(localStorage.getItem("metist_costs") || "[]");

    const colors = { 
        ‡πÅ‡∏î‡∏á: "#e63946", 
        ‡∏Ç‡∏≤‡∏ß: "#ffffff", 
        ‡∏ä‡∏°‡∏û‡∏π: "#f7b2cc", 
        ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô: "#457b9d", 
        ‡∏°‡πà‡∏ß‡∏á: "#9b5de5", 
        ‡∏î‡∏≥: "#333333", 
        ‡∏ä‡∏°‡∏û‡∏π‡πÅ‡∏Å‡πâ‡∏ß: "#ff007f", 
        ‡πÅ‡∏î‡∏á‡πÅ‡∏Å‡πâ‡∏ß: "#b91d1d" 
    };
    const extraPrice = { ‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠: 5, ‡∏°‡∏á‡∏Å‡∏∏‡∏é: 10, ‡πÑ‡∏üLED: 25, ‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å: 0, ‡∏Ç‡∏≠‡∏ö‡∏•‡∏π‡∏Å‡πÑ‡∏°‡πâ: 0, ‡∏Ç‡∏≠‡∏ö‡∏°‡∏∏‡∏Å: 0, ‡∏Å‡∏≤‡∏£‡πå‡∏î: 0 };

    let currentFlowerData = { "‡∏û‡∏∑‡πâ‡∏ô": {}, "‡∏Å‡∏£‡∏¥‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå": {} };
    let selectedPapers = []; 
    let selectedBows = []; 
    let selectedExtras = {};
    let brData = { stones: {}, chain: "", lock: "", lockPrice: 0, chainPrice: 0, accessories: [], basePrice: 59, wristSize: "" };

    const cleanPrice = (val) => typeof val === 'number' ? val : parseFloat(String(val).replace(/[^0-9.]/g, '')) || 0;

    function switchPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-menu button').forEach(b => b.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        document.getElementById('btn-' + pageId).classList.add('active');
        if(pageId === 'orders') renderOrderList();
        if(pageId === 'summary') renderSummary();
        updatePendingNav();
    }

    function renderFlowers() {
        const flowerList = ["‡πÅ‡∏î‡∏á", "‡∏Ç‡∏≤‡∏ß", "‡∏ä‡∏°‡∏û‡∏π", "‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô", "‡∏°‡πà‡∏ß‡∏á"];
        document.getElementById("flower-grid").innerHTML = flowerList.map(c => `
            <div class="color-item" onclick="addFlower('${c}')">
                <div class="color-btn" style="background:${colors[c]}"></div>
                <div class="count">${c}<br>‡∏û‡∏∑‡πâ‡∏ô:${currentFlowerData["‡∏û‡∏∑‡πâ‡∏ô"][c]||0} ‡∏Å‡∏£‡∏¥‡∏ï:${currentFlowerData["‡∏Å‡∏£‡∏¥‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå"][c]||0}</div>
            </div>`).join("");
    }

    function addFlower(color) {
        const type = document.querySelector('input[name="flowerType"]:checked').value;
        currentFlowerData[type][color] = (currentFlowerData[type][color] || 0) + 1;
        renderFlowers(); calcTotal();
    }

    function calcTotal() {
        let total = Number(document.getElementById("basePrice").value || 0);
        Object.keys(selectedExtras).forEach(e => total += (selectedExtras[e] * extraPrice[e]));
        document.getElementById("summary-text").innerText = `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: ${total} ‡∏ö‡∏≤‡∏ó`;
        return total;
    }

    function addStone(name) { brData.stones[name] = (brData.stones[name] || 0) + 1; renderStoneList(); calcBrTotal(); }
    function renderStoneList() {
        let sel = []; for (let s in brData.stones) { if (brData.stones[s] > 0) sel.push(`${s}x${brData.stones[s]}`); }
        document.getElementById('stoneChoice').innerText = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏¥‡∏ô: " + (sel.join(", ") || "-");
    }
    function setChain(n) { brData.chain = n; brData.chainPrice = n.includes('‡∏ó‡∏≠‡∏á') ? 10 : 0; document.getElementById('chainChoice').innerText = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: "+n; calcBrTotal(); }
    function setLock(n, p) { brData.lock = n; brData.lockPrice = p; document.getElementById('lockChoice').innerText = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: "+n; calcBrTotal(); }
    function addAccessory(n) { brData.accessories.push(n); document.getElementById('accList').innerText = "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: " + brData.accessories.join(","); calcBrTotal(); }
    function calcBrTotal() {
        let total = brData.basePrice;
        let sCount = Object.values(brData.stones).reduce((a, b) => a + b, 0);
        if (sCount > 1) total += (sCount - 1) * 30;
        total += brData.lockPrice + brData.chainPrice;
        let normal = 0, pearl = 0;
        brData.accessories.forEach(i => i === '‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å' ? pearl++ : normal++);
        if (normal > 1) total += (normal - 1) * 5;
        if (pearl > 1) total += (pearl - 1) * 5;
        document.getElementById("br-summary-text").innerText = `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: ${total} ‡∏ö‡∏≤‡∏ó`;
        return total;
    }

    function resetBracelet() {
        brData = { stones: {}, chain: "", lock: "", lockPrice: 0, chainPrice: 0, accessories: [], basePrice: 59, wristSize: "" };
        document.getElementById('stoneChoice').innerText = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏¥‡∏ô: -"; document.getElementById('chainChoice').innerText = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡πà: -";
        document.getElementById('lockChoice').innerText = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏•‡πá‡∏≠‡∏Ñ: -"; document.getElementById('accList').innerText = "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: -";
        document.getElementById('wrist-size').value = ""; calcBrTotal();
    }

    function saveOrder(productType) {
        let name, total, details;
        if(productType === '‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ') {
            name = document.getElementById("customer").value;
            total = calcTotal();
            details = { flowers: JSON.parse(JSON.stringify(currentFlowerData)), paper: selectedPapers.join(", "), bow: selectedBows.join(", "), extras: {...selectedExtras} };
        } else {
            name = document.getElementById("customer-br").value;
            total = calcBrTotal();
            brData.wristSize = document.getElementById('wrist-size').value;
            details = JSON.parse(JSON.stringify(brData));
        }
        if(!name) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤"); return; }
        orders.push({ id: Date.now(), name, type: productType, total, details, date: new Date().toLocaleDateString('th-TH'), status: false, paid: false });
        localStorage.setItem("metist_orders", JSON.stringify(orders));
        
        if(productType === '‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ') {
            document.getElementById("customer").value = ""; currentFlowerData = { "‡∏û‡∏∑‡πâ‡∏ô": {}, "‡∏Å‡∏£‡∏¥‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå": {} };
            selectedPapers = []; selectedBows = []; selectedExtras = {};
            document.getElementById("basePrice").value = ""; renderFlowers(); calcTotal();
        } else {
            resetBracelet(); document.getElementById("customer-br").value = "";
        }
        document.getElementById("searchOrder").value = "";
        switchPage('orders');
    }

    function renderOrderList() {
        const listDiv = document.getElementById("order-list");
        const search = document.getElementById("searchOrder").value.toLowerCase();
        
        let filtered = orders.filter(o => o.name.toLowerCase().includes(search));
        
        filtered.sort((a, b) => {
            if (a.status !== b.status) return a.status ? 1 : -1;
            if (a.status === true && b.status === true) {
                if (a.paid !== b.paid) return a.paid ? 1 : -1;
            }
            return b.id - a.id;
        });

        const pending = orders.filter(o => !o.status).length;
        document.getElementById("pending-count").innerText = `‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£: ${pending}`;

        listDiv.innerHTML = filtered.map((o) => {
            const realIdx = orders.findIndex(orig => orig.id === o.id);
            const isFlower = o.type === '‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ';
            const accent = isFlower ? '#d48398' : '#9b5de5';
            const bg = isFlower ? '#fff5f8' : '#f9f5ff';

            return `
                <div class="order-item" style="border-left: 8px solid ${accent}; background: ${bg};">
                    <div style="display:flex; justify-content:space-between; font-size:11px; font-weight:bold; color:${accent}">
                        <span>${isFlower ? 'üå∏ FLOWER' : 'üîÆ BRACELET'} ${o.status ? '‚úÖ' : '‚è≥'}</span>
                        <span style="color:gray">${o.date}</span>
                    </div>
                    <div style="margin:5px 0"><b>üë§ ${o.name}</b></div>
                    <div style="font-weight:bold">‡∏¢‡∏≠‡∏î: ${cleanPrice(o.total).toLocaleString()} ‡∏ø</div>
                    <div class="btn-group">
                        <button class="status-btn" style="background:${o.status ? '#51cf66' : '#ff6b6b'}; flex:1" onclick="toggleStatus(${realIdx})">
                            ${o.status ? '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß' : '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}
                        </button>
                        <button class="status-btn" style="background:${o.paid ? '#51cf66' : '#ff6b6b'}; flex:1" onclick="togglePaid(${realIdx})">
                            ${o.paid ? '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ä‡∏≥‡∏£‡∏∞'}
                        </button>
                    </div>
                    <div class="btn-group">
                        <button class="status-btn" style="background:white; color:${accent}; border:1px solid ${accent}; flex:1" onclick="openPopup(${realIdx}, 'order')">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                        <button class="status-btn" style="background:white; color:${accent}; border:1px solid ${accent}; flex:1" onclick="openPopup(${realIdx}, 'receipt')">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</button>
                        <button class="status-btn" style="background:#eee; color:#999; width:35px" onclick="deleteOrder(${realIdx})">üóëÔ∏è</button>
                    </div>
                </div>`;
        }).join("");

        if (filtered.length === 0) {
            listDiv.innerHTML = `<div style="text-align:center; padding:40px; color:#999;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...</div>`;
        }
    }

    function openPopup(i, mode) {
        const o = orders[i]; 
        const isReceipt = mode === 'receipt';
        let body = isReceipt ? `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ‡∏Ñ‡∏∏‡∏ì ${o.name}<br>` : `üë§ <b>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</b> ${o.name}<br>`;
        
        if (o.type === '‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ') {
            let fTxt = [];
            for (let t in o.details.flowers) {
                for (let c in o.details.flowers[t]) {
                    if (o.details.flowers[t][c] > 0) {
                        fTxt.push(`${c}${t==='‡∏Å‡∏£‡∏¥‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå'?'(‡∏Å‡∏£‡∏¥‡∏ï)':''} x${o.details.flowers[t][c]}`);
                    }
                }
            }
            if (isReceipt) {
                body += `‡∏™‡∏µ‡∏î‡∏≠‡∏Å: ${fTxt.join(", ")}<br>` +
                        `‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏´‡πà‡∏≠: ${o.details.paper||'-'}<br>` +
                        `‡πÇ‡∏ö‡∏ß‡πå: ${o.details.bow||'-'}<br>` +
                        `‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á: ${Object.entries(o.details.extras).filter(e=>e[1]>0).map(e=>e[0]).join(",")||'-'}`;
            } else {
                body += `üåπ <b>‡∏™‡∏µ‡∏î‡∏≠‡∏Å:</b> ${fTxt.join(", ")}<br>` +
                        `üì¶ <b>‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏´‡πà‡∏≠:</b> ${o.details.paper||'-'}<br>` +
                        `üéÄ <b>‡πÇ‡∏ö‡∏ß‡πå:</b> ${o.details.bow||'-'}<br>` +
                        `‚ú® <b>‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á:</b> ${Object.entries(o.details.extras).filter(e=>e[1]>0).map(e=>e[0]).join(",")||'-'}`;
            }
        } else {
            let sTxt = []; 
            for (let s in o.details.stones) if (o.details.stones[s] > 0) sTxt.push(`${s}x${o.details.stones[s]}`);
            let accTxt = (o.details.accessories && o.details.accessories.length > 0) ? o.details.accessories.join(", ") : "-";
            if (isReceipt) {
                body += `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ‡∏Å‡∏≥‡πÑ‡∏•‡∏´‡∏¥‡∏ô‡∏°‡∏á‡∏Ñ‡∏•<br>` +
                        `‡∏´‡∏¥‡∏ô: ${sTxt.join(", ")}<br>` +
                        `‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠: ${o.details.wristSize}cm<br>` +
                        `‡πÇ‡∏ã‡πà: ${o.details.chain}<br>` +
                        `‡∏ï‡∏±‡∏ß‡∏•‡πá‡∏≠‡∏Ñ: ${o.details.lock}<br>` +
                        `‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á: ${accTxt}`;
            } else {
                body += `üîÆ <b>‡∏´‡∏¥‡∏ô:</b> ${sTxt.join(", ")}<br>` +
                        `üìè <b>‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠:</b> ${o.details.wristSize}cm<br>` +
                        `‚õìÔ∏è <b>‡πÇ‡∏ã‡πà:</b> ${o.details.chain}<br>` +
                        `üîí <b>‡∏ï‡∏±‡∏ß‡∏•‡πá‡∏≠‡∏Ñ:</b> ${o.details.lock}<br>` +
                        `‚ú® <b>‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á:</b> ${accTxt}`;
            }
        }
        body += `<br><br><b style="font-size:1.2rem; color:var(--pink-dark)">${isReceipt ? '‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:' : 'üí∞ ‡∏£‡∏ß‡∏°:'} ${cleanPrice(o.total).toLocaleString()} ‡∏ø</b>`;
        document.getElementById("rc-date").innerText = "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: " + o.date;
        document.getElementById("modal-body").innerHTML = body;
        document.getElementById("receipt-extras").style.display = isReceipt ? "block" : "none";
        document.getElementById("receiptModal").style.display = "block";
    }

    function renderSummary() {
        const total = orders.reduce((s, o) => s + cleanPrice(o.total), 0);
        const fSale = orders.filter(o => o.type === '‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ').reduce((s, o) => s + cleanPrice(o.total), 0);
        const bSale = orders.filter(o => o.type === '‡∏Å‡∏≥‡πÑ‡∏•').reduce((s, o) => s + cleanPrice(o.total), 0);
        const cost = costs.reduce((s, c) => s + (Number(c.amount) || 0), 0);
        document.getElementById("stat-sale").innerText = total.toLocaleString();
        document.getElementById("stat-flower-sale").innerText = fSale.toLocaleString();
        document.getElementById("stat-bracelet-sale").innerText = bSale.toLocaleString();
        document.getElementById("stat-cost").innerText = cost.toLocaleString();
        document.getElementById("stat-profit").innerText = (total - cost).toLocaleString();
        document.getElementById("cost-history-body").innerHTML = [...costs].reverse().map((c, i) => 
            `<tr><td>${c.date}</td><td>${c.desc}</td><td>${Number(c.amount).toLocaleString()}</td><td><button onclick="deleteCost(${costs.length-1-i})" style="border:none; color:red; background:none; cursor: pointer;">‡∏•‡∏ö</button></td></tr>`
        ).join("");
    }

    function updatePendingNav() {
        const p = orders.filter(o => !o.status).length;
        document.getElementById("nav-pending").innerText = p > 0 ? `(${p})` : "";
    }
    
function showTaskSummary() {
    // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° (status: false)
    const pendingOrders = orders.filter(o => o.type === '‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ' && !o.status);
    
    let summary = {};
    let totalFlowers = 0;

    pendingOrders.forEach(order => {
        const flowers = order.details.flowers;
        for (let type in flowers) {
            for (let color in flowers[type]) {
                const count = flowers[type][color];
                if (count > 0) {
                    // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏µ ‡πÅ‡∏•‡∏∞ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏à‡∏£‡∏¥‡∏á‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
                    const key = `${color} (${type})`;
                    if (!summary[key]) {
                        summary[key] = { count: 0, colorCode: colors[color] || '#ccc' };
                    }
                    summary[key].count += count;
                    totalFlowers += count;
                }
            }
        }
    });

    let html = `<h3 style="margin-top:0; color:var(--pink-dark);">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥</h3>`;
    
    if (totalFlowers === 0) {
        html += `<p style="color:gray;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà</p>`;
    } else {
        html += `<div style="text-align:left; background:#fff5f8; padding:15px; border-radius:15px; border:1px dashed var(--pink);">`;
        for (let key in summary) {
            html += `
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:6px;">
                    <div style="display:flex; align-items:center;">
                        <div style="width:14px; height:14px; background:${summary[key].colorCode}; border-radius:50%; margin-right:10px; border:1px solid rgba(0,0,0,0.1);"></div>
                        <span style="font-size:14px;">${key}</span>
                    </div>
                    <b style="color:var(--pink-dark); font-size:1.1rem;">x ${summary[key].count}</b>
                </div>`;
        }
        html += `<div style="text-align:right; margin-top:12px; font-size:16px; font-weight:bold; color:var(--text);">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalFlowers} ‡∏î‡∏≠‡∏Å</div>`;
        html += `</div>`;
        html += `<p style="font-size:11px; color:gray; margin-top:10px;">*‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà "‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>`;
    }

    document.getElementById("modal-body").innerHTML = html;
    document.getElementById("rc-date").innerText = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: " + new Date().toLocaleTimeString('th-TH');
    document.getElementById("receipt-extras").style.display = "none"; 
    document.getElementById("receiptModal").style.display = "block";
}

    function toggleStatus(i) { orders[i].status = !orders[i].status; updateStore(); }
    function togglePaid(i) { orders[i].paid = !orders[i].paid; updateStore(); }
    function deleteOrder(i) { if(confirm("‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ?")) { orders.splice(i, 1); updateStore(); } }
    function addCost() { 
        const d = document.getElementById("cost-desc").value, a = document.getElementById("cost-amount").value;
        if(!a) return; costs.push({ desc: d||"‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", amount: a, date: new Date().toLocaleDateString('th-TH') });
        localStorage.setItem("metist_costs", JSON.stringify(costs)); renderSummary();
        document.getElementById("cost-desc").value = ""; document.getElementById("cost-amount").value = "";
    }
    function deleteCost(i) { costs.splice(i,1); localStorage.setItem("metist_costs", JSON.stringify(costs)); renderSummary(); }
    function updateStore() { localStorage.setItem("metist_orders", JSON.stringify(orders)); renderOrderList(); updatePendingNav(); }
    function closeModal() { document.getElementById("receiptModal").style.display = "none"; }
    
    function exportData() {
        const blob = new Blob([JSON.stringify({ orders, costs })], { type: "application/json" });
        const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = `METIST_Backup.json`; a.click();
    }
    function importData(e) {
        const reader = new FileReader(); reader.onload = (ev) => {
            const data = JSON.parse(ev.target.result);
            if (confirm("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?")) { localStorage.setItem("metist_orders", JSON.stringify(data.orders)); localStorage.setItem("metist_costs", JSON.stringify(data.costs)); location.reload(); }
        }; reader.readAsText(e.target.files[0]);
    }

    document.getElementById("paper-grid").innerHTML = ["‡∏î‡∏≥", "‡∏Ç‡∏≤‡∏ß", "‡∏ä‡∏°‡∏û‡∏π", "‡πÅ‡∏î‡∏á"].map(c => `<button class="square-btn" style="background:${colors[c]}; color:${c==='‡∏Ç‡∏≤‡∏ß'?'#555':'#fff'}" onclick="selectedPapers.push('${c}'); document.getElementById('paperChoice').innerText='‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: '+selectedPapers.join(',')">${c}</button>`).join("");
    
    // --- ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏ö‡∏ß‡πå ‡∏ä‡∏°‡∏û‡∏π‡πÅ‡∏Å‡πâ‡∏ß ‡πÅ‡∏•‡∏∞ ‡πÅ‡∏î‡∏á‡πÅ‡∏Å‡πâ‡∏ß ---
    document.getElementById("bow-grid").innerHTML = ["‡πÅ‡∏î‡∏á", "‡∏Ç‡∏≤‡∏ß", "‡∏ä‡∏°‡∏û‡∏π", "‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô", "‡∏°‡πà‡∏ß‡∏á", "‡∏ä‡∏°‡∏û‡∏π‡πÅ‡∏Å‡πâ‡∏ß", "‡πÅ‡∏î‡∏á‡πÅ‡∏Å‡πâ‡∏ß"].map(c => `<button class="square-btn" style="background:${colors[c]}; color:${c==='‡∏Ç‡∏≤‡∏ß'?'#555':'#fff'}" onclick="selectedBows.push('${c}'); document.getElementById('bowChoice').innerText='‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: '+selectedBows.join(',')">${c}</button>`).join("");
    
    document.getElementById("extra-grid").innerHTML = Object.keys(extraPrice).map(e => `<button class="square-btn" style="background:#f2b5d4; color:#5a3d45;" onclick="selectedExtras['${e}']=(selectedExtras['${e}']||0)+1; calcTotal()">${e}+${extraPrice[e]}</button>`).join("");

    renderFlowers();
    updatePendingNav();
</script>

</body>
</html>